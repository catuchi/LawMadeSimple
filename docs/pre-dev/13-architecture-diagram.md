# Architecture Diagrams

> Visual representations of LawMadeSimple system architecture.

---

## System Context Diagram (C4 Level 1)

Shows the system and its interactions with external actors and systems.

```
                                    ┌─────────────────────────────┐
                                    │        NigeriaLII           │
                                    │      (Law Content)          │
                                    └──────────────┬──────────────┘
                                                   │
                                           Content Import
                                                   │
┌─────────────────┐                               ▼
│                 │         ┌─────────────────────────────────────────────┐
│   Nigerian      │         │                                             │
│   Citizens      │◀───────▶│            LawMadeSimple                    │
│   (Users)       │   Web   │         (Web Application)                   │
│                 │         │                                             │
└─────────────────┘         │   • Browse laws in plain language           │
                            │   • Get AI-powered explanations             │
┌─────────────────┐         │   • Search by scenario                      │
│                 │         │   • Save and share content                  │
│   Nigerian      │◀───────▶│                                             │
│   SMEs          │   Web   │                                             │
│                 │         └────────────────────┬────────────────────────┘
└─────────────────┘                              │
                                                 │
                     ┌───────────────────────────┼───────────────────────────┐
                     │                           │                           │
                     ▼                           ▼                           ▼
          ┌─────────────────┐         ┌─────────────────┐         ┌─────────────────┐
          │   OpenAI API    │         │    Supabase     │         │     Resend      │
          │                 │         │                 │         │                 │
          │  AI Explanations│         │  Database/Auth  │         │  Email Service  │
          └─────────────────┘         └─────────────────┘         └─────────────────┘
```

---

## Container Diagram (C4 Level 2)

Shows the high-level technical building blocks.

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              LawMadeSimple System                                │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           Vercel Platform                                │   │
│  │                                                                         │   │
│  │   ┌─────────────────────────────┐   ┌─────────────────────────────┐    │   │
│  │   │      Next.js Frontend       │   │      Next.js API Routes     │    │   │
│  │   │                             │   │                             │    │   │
│  │   │  • React Components         │──▶│  • /api/laws/*              │    │   │
│  │   │  • Tailwind + shadcn/ui     │   │  • /api/explanations/*      │    │   │
│  │   │  • PWA Service Worker       │   │  • /api/search/*            │    │   │
│  │   │  • Client State             │   │  • /api/bookmarks/*         │    │   │
│  │   │                             │   │  • /api/feedback/*          │    │   │
│  │   │  [React, TypeScript]        │   │  [Node.js, Prisma, Zod]     │    │   │
│  │   └─────────────────────────────┘   └──────────────┬──────────────┘    │   │
│  │                                                     │                   │   │
│  └─────────────────────────────────────────────────────┼───────────────────┘   │
│                                                        │                       │
└────────────────────────────────────────────────────────┼───────────────────────┘
                                                         │
              ┌──────────────────────────────────────────┼──────────────────────┐
              │                                          │                      │
              ▼                                          ▼                      ▼
   ┌─────────────────────┐               ┌─────────────────────────────────────────┐
   │    OpenAI API       │               │              Supabase                    │
   │                     │               │                                         │
   │  • GPT-4o           │               │  ┌─────────┐  ┌─────────┐  ┌─────────┐ │
   │  • GPT-4o-mini      │               │  │PostgreSQL│  │  Auth   │  │ Storage │ │
   │  • Streaming        │               │  │         │  │         │  │         │ │
   │                     │               │  │ • Laws  │  │ • OAuth │  │ • PDFs  │ │
   │  [External Service] │               │  │ • Users │  │ • Magic │  │ • Cache │ │
   └─────────────────────┘               │  │ • Cache │  │   Link  │  │         │ │
                                         │  └─────────┘  └─────────┘  └─────────┘ │
                                         │                                         │
                                         │  [Managed Services]                     │
                                         └─────────────────────────────────────────┘
```

---

## Component Diagram (C4 Level 3) — API Layer

Detailed view of the API routes component.

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              API Routes Container                                │
│                                                                                 │
│  ┌───────────────────────────────────────────────────────────────────────────┐ │
│  │                              Middleware Layer                              │ │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────────────┐  │ │
│  │  │   CORS     │  │  Auth      │  │  Rate      │  │  Error             │  │ │
│  │  │   Handler  │  │  Verify    │  │  Limiter   │  │  Handler           │  │ │
│  │  └────────────┘  └────────────┘  └────────────┘  └────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────────────┘ │
│                                          │                                      │
│  ┌───────────────────────────────────────┼───────────────────────────────────┐ │
│  │                              Route Handlers                                │ │
│  │                                       │                                    │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐  │ │
│  │  │  Laws       │  │ Explanations│  │  Search     │  │  User           │  │ │
│  │  │  Controller │  │  Controller │  │  Controller │  │  Controller     │  │ │
│  │  │             │  │             │  │             │  │                 │  │ │
│  │  │ GET /laws   │  │ GET /explain│  │ GET /search │  │ GET/POST        │  │ │
│  │  │ GET /laws/:id│ │ POST /explain│ │             │  │ /bookmarks      │  │ │
│  │  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └────────┬────────┘  │ │
│  │         │                │                │                   │          │ │
│  └─────────┼────────────────┼────────────────┼───────────────────┼──────────┘ │
│            │                │                │                   │            │
│  ┌─────────┼────────────────┼────────────────┼───────────────────┼──────────┐ │
│  │         ▼                ▼                ▼                   ▼          │ │
│  │  ┌─────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                         Service Layer                                │ │ │
│  │  │                                                                     │ │ │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌────────────┐ │ │ │
│  │  │  │ LawService  │  │ AIService   │  │SearchService│  │UserService │ │ │ │
│  │  │  │             │  │             │  │             │  │            │ │ │ │
│  │  │  │ • getLaws   │  │ • explain   │  │ • search    │  │• getUser   │ │ │ │
│  │  │  │ • getSection│  │ • stream    │  │ • suggest   │  │• saveBookmk│ │ │ │
│  │  │  │ • getScenario│ │ • cache    │  │             │  │• feedback  │ │ │ │
│  │  │  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └─────┬──────┘ │ │ │
│  │  │         │                │                │                │       │ │ │
│  │  └─────────┼────────────────┼────────────────┼────────────────┼───────┘ │ │
│  │            │                │                │                │         │ │
│  └────────────┼────────────────┼────────────────┼────────────────┼─────────┘ │
│               │                │                │                │           │
│               ▼                ▼                ▼                ▼           │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                          Data Access Layer                              │ │
│  │                                                                         │ │
│  │        ┌─────────────────────┐          ┌─────────────────────┐        │ │
│  │        │   Prisma Client     │          │   OpenAI Client     │        │ │
│  │        │                     │          │   (Vercel AI SDK)   │        │ │
│  │        │   → PostgreSQL      │          │   → OpenAI API      │        │ │
│  │        └─────────────────────┘          └─────────────────────┘        │ │
│  │                                                                         │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                               │
└───────────────────────────────────────────────────────────────────────────────┘
```

---

## Component Diagram (C4 Level 3) — Frontend

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                             Frontend Container                                   │
│                                                                                 │
│  ┌───────────────────────────────────────────────────────────────────────────┐ │
│  │                              App Router Layout                             │ │
│  │  ┌────────────────────────────────────────────────────────────────────┐  │ │
│  │  │  RootLayout (providers, theme, fonts)                              │  │ │
│  │  └────────────────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────────────┘ │
│                                          │                                      │
│  ┌───────────────────────────────────────┼───────────────────────────────────┐ │
│  │                              Page Components                               │ │
│  │                                                                           │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐  │ │
│  │  │  HomePage   │  │  LawPage    │  │ SearchPage  │  │  ProfilePage    │  │ │
│  │  │             │  │             │  │             │  │                 │  │ │
│  │  │ • Hero      │  │ • LawHeader │  │ • SearchBar │  │ • Bookmarks     │  │ │
│  │  │ • Scenarios │  │ • Sections  │  │ • Results   │  │ • History       │  │ │
│  │  │ • Featured  │  │ • Explain   │  │ • Filters   │  │ • Settings      │  │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────────┘  │ │
│  │                                                                           │ │
│  └───────────────────────────────────────────────────────────────────────────┘ │
│                                          │                                      │
│  ┌───────────────────────────────────────┼───────────────────────────────────┐ │
│  │                              UI Components (shadcn/ui)                     │ │
│  │                                                                           │ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────────┐│ │
│  │  │  Button  │ │   Card   │ │  Input   │ │  Dialog  │ │  Accordion       ││ │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────────────┘│ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────────┐│ │
│  │  │  Badge   │ │  Toast   │ │ Skeleton │ │  Sheet   │ │  NavigationMenu  ││ │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────────────┘│ │
│  │                                                                           │ │
│  └───────────────────────────────────────────────────────────────────────────┘ │
│                                          │                                      │
│  ┌───────────────────────────────────────┼───────────────────────────────────┐ │
│  │                              State & Data Fetching                         │ │
│  │                                                                           │ │
│  │  ┌─────────────────────┐  ┌─────────────────────┐  ┌────────────────────┐│ │
│  │  │   React Query       │  │   Zustand / Context │  │  Supabase Client   ││ │
│  │  │   (Server State)    │  │   (Client State)    │  │  (Auth Sessions)   ││ │
│  │  └─────────────────────┘  └─────────────────────┘  └────────────────────┘│ │
│  │                                                                           │ │
│  └───────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## Deployment Diagram

```
                              ┌─────────────────────────────────────┐
                              │            Internet                  │
                              └──────────────────┬──────────────────┘
                                                 │
                                                 ▼
┌────────────────────────────────────────────────────────────────────────────────┐
│                              Vercel Edge Network                                │
│                                                                                │
│   ┌────────────────────────────────────────────────────────────────────────┐  │
│   │                              Global CDN                                 │  │
│   │                                                                        │  │
│   │   • Static assets (JS, CSS, images)                                    │  │
│   │   • Cached responses                                                   │  │
│   │   • Edge caching rules                                                 │  │
│   │                                                                        │  │
│   │   Regions: US, EU, Asia (automatic)                                    │  │
│   └────────────────────────────────────────────────────────────────────────┘  │
│                                         │                                      │
│   ┌────────────────────────────────────────────────────────────────────────┐  │
│   │                         Serverless Functions                            │  │
│   │                                                                        │  │
│   │   ┌──────────────────────────────────────────────────────────────┐    │  │
│   │   │  Function: api/laws/[id]          │  Timeout: 10s            │    │  │
│   │   │  Function: api/explanations       │  Timeout: 30s (streaming)│    │  │
│   │   │  Function: api/search             │  Timeout: 10s            │    │  │
│   │   │  Function: api/bookmarks          │  Timeout: 10s            │    │  │
│   │   │  Function: api/feedback           │  Timeout: 10s            │    │  │
│   │   └──────────────────────────────────────────────────────────────┘    │  │
│   │                                                                        │  │
│   │   Region: iad1 (US East) — closest to Supabase                        │  │
│   └────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
                                         │
              ┌──────────────────────────┼──────────────────────────┐
              │                          │                          │
              ▼                          ▼                          ▼
┌─────────────────────────┐ ┌─────────────────────────┐ ┌─────────────────────────┐
│   Supabase (AWS US)     │ │      OpenAI API         │ │     Resend              │
│                         │ │                         │ │                         │
│ ┌─────────────────────┐ │ │ • api.openai.com        │ │ • api.resend.com        │
│ │  PostgreSQL         │ │ │ • GPT-4o, GPT-4o-mini   │ │ • Transactional email   │
│ │  • Primary DB       │ │ │ • Streaming responses   │ │ • Magic links           │
│ │  • Connection pool  │ │ │                         │ │                         │
│ └─────────────────────┘ │ └─────────────────────────┘ └─────────────────────────┘
│ ┌─────────────────────┐ │
│ │  Auth Service       │ │
│ │  • OAuth handling   │ │
│ │  • Session mgmt     │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │  Storage (S3)       │ │
│ │  • File storage     │ │
│ │  • CDN delivery     │ │
│ └─────────────────────┘ │
│                         │
│ Region: us-east-1       │
└─────────────────────────┘
```

---

## Data Flow Diagram — AI Explanation Request

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│  User    │     │ Frontend │     │   API    │     │  Cache   │     │  OpenAI  │
│ Browser  │     │  (React) │     │  Route   │     │   (DB)   │     │   API    │
└────┬─────┘     └────┬─────┘     └────┬─────┘     └────┬─────┘     └────┬─────┘
     │                │                │                │                │
     │ 1. Click       │                │                │                │
     │ "Explain"      │                │                │                │
     │───────────────▶│                │                │                │
     │                │                │                │                │
     │                │ 2. POST        │                │                │
     │                │ /api/explain   │                │                │
     │                │───────────────▶│                │                │
     │                │                │                │                │
     │                │                │ 3. Check       │                │
     │                │                │ cache          │                │
     │                │                │───────────────▶│                │
     │                │                │                │                │
     │                │                │ 4a. Cache hit  │                │
     │                │                │◀───────────────│                │
     │                │                │                │                │
     │                │                │ ─ ─ OR ─ ─ ─ ─│                │
     │                │                │                │                │
     │                │                │ 4b. Cache miss │                │
     │                │                │                │ 5. Stream      │
     │                │                │                │ request        │
     │                │                │                │───────────────▶│
     │                │                │                │                │
     │                │                │                │ 6. Stream      │
     │                │                │◀───────────────│◀───────────────│
     │                │                │ response       │                │
     │                │                │                │                │
     │                │                │ 7. Save to     │                │
     │                │                │ cache          │                │
     │                │                │───────────────▶│                │
     │                │                │                │                │
     │                │ 8. Stream      │                │                │
     │                │ response       │                │                │
     │                │◀───────────────│                │                │
     │                │                │                │                │
     │ 9. Display     │                │                │                │
     │ explanation    │                │                │                │
     │◀───────────────│                │                │                │
     │                │                │                │                │
```

---

## Data Flow Diagram — User Authentication

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│  User    │     │ Frontend │     │ Supabase │     │  Google  │     │  Resend  │
│ Browser  │     │  (React) │     │   Auth   │     │  OAuth   │     │  (Email) │
└────┬─────┘     └────┬─────┘     └────┬─────┘     └────┬─────┘     └────┬─────┘
     │                │                │                │                │
     │ ═══════════════════════════════════════════════════════════════════════
     │                         GOOGLE OAUTH FLOW
     │ ═══════════════════════════════════════════════════════════════════════
     │                │                │                │                │
     │ 1. Click       │                │                │                │
     │ "Sign in"      │                │                │                │
     │───────────────▶│                │                │                │
     │                │ 2. Redirect    │                │                │
     │                │───────────────▶│                │                │
     │                │                │ 3. OAuth URL   │                │
     │◀───────────────│◀───────────────│───────────────▶│                │
     │ 4. Google      │                │                │                │
     │ login page     │                │                │                │
     │───────────────────────────────────────────────────▶                │
     │                │                │                │                │
     │                │                │ 5. Token       │                │
     │                │                │◀───────────────│                │
     │                │ 6. Callback    │                │                │
     │◀───────────────│◀───────────────│                │                │
     │                │ + session      │                │                │
     │                │                │                │                │
     │ ═══════════════════════════════════════════════════════════════════════
     │                         MAGIC LINK FLOW
     │ ═══════════════════════════════════════════════════════════════════════
     │                │                │                │                │
     │ 1. Enter email │                │                │                │
     │───────────────▶│                │                │                │
     │                │ 2. Request     │                │                │
     │                │ magic link     │                │                │
     │                │───────────────▶│                │                │
     │                │                │ 3. Send email  │                │
     │                │                │───────────────────────────────▶│
     │                │                │                │                │
     │ 4. Email with  │                │                │                │
     │ magic link     │◀──────────────────────────────────────────────────
     │                │                │                │                │
     │ 5. Click link  │                │                │                │
     │───────────────────────────────▶│                │                │
     │                │                │                │                │
     │                │ 6. Verify      │                │                │
     │◀───────────────│◀───────────────│                │                │
     │                │ + session      │                │                │
     │                │                │                │                │
```

---

## Network Topology

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                 Internet                                     │
│                                                                             │
│   Users (Nigeria, Worldwide)                                                │
│        │                                                                    │
│        │ HTTPS (TLS 1.3)                                                    │
│        ▼                                                                    │
│   ┌─────────────────────────────────────────────────────────────────┐      │
│   │                    Vercel Edge Network                           │      │
│   │                                                                 │      │
│   │   • Global Points of Presence                                   │      │
│   │   • DDoS Protection                                             │      │
│   │   • SSL Termination                                             │      │
│   │   • Edge Caching                                                │      │
│   │                                                                 │      │
│   └───────────────────────────┬─────────────────────────────────────┘      │
│                               │                                             │
│                               │ Internal (Vercel Network)                   │
│                               ▼                                             │
│   ┌─────────────────────────────────────────────────────────────────┐      │
│   │                  Vercel Serverless (US East)                     │      │
│   │                                                                 │      │
│   │   • Next.js Functions                                           │      │
│   │   • Environment Variables (Encrypted)                           │      │
│   │                                                                 │      │
│   └───────────────────────────┬─────────────────────────────────────┘      │
│                               │                                             │
│              ┌────────────────┼────────────────┐                           │
│              │                │                │                           │
│              ▼                ▼                ▼                           │
│   ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐             │
│   │  Supabase       │ │   OpenAI        │ │   Resend        │             │
│   │  (AWS US-East)  │ │   (Azure)       │ │   (AWS)         │             │
│   │                 │ │                 │ │                 │             │
│   │  HTTPS + SSL    │ │  HTTPS + API Key│ │  HTTPS + API Key│             │
│   └─────────────────┘ └─────────────────┘ └─────────────────┘             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

*Document: 13 of 20 | Phase 4: Architecture Planning*
*Project: LawMadeSimple | Created: January 2026*
