# UML Diagrams

> Behavioral and structural diagrams for LawMadeSimple.

---

## Use Case Diagram

```
                         ┌──────────────────────────────────────────────────────────────┐
                         │                    LawMadeSimple System                       │
                         │                                                              │
    ┌───────────┐        │   ┌────────────────────────────────────────────────────┐    │
    │           │        │   │                                                    │    │
    │   Guest   │────────│──▶│              Browse Laws                           │    │
    │   User    │        │   │                                                    │    │
    │           │        │   └────────────────────────────────────────────────────┘    │
    └───────────┘        │                          │                                   │
         │               │                          │ <<include>>                       │
         │               │                          ▼                                   │
         │               │   ┌────────────────────────────────────────────────────┐    │
         │               │   │                                                    │    │
         ├───────────────│──▶│              Search Content                        │    │
         │               │   │                                                    │    │
         │               │   └────────────────────────────────────────────────────┘    │
         │               │                                                              │
         │               │   ┌────────────────────────────────────────────────────┐    │
         │               │   │                                                    │    │
         ├───────────────│──▶│           View AI Explanations                     │    │
         │               │   │                                                    │    │
         │               │   └────────────────────────────────────────────────────┘    │
         │               │                          │                                   │
         │               │                          │ <<extend>>                        │
         │               │                          ▼                                   │
         │               │   ┌────────────────────────────────────────────────────┐    │
         │               │   │                                                    │    │
         └───────────────│──▶│           Explore Scenarios                        │    │
                         │   │                                                    │    │
                         │   └────────────────────────────────────────────────────┘    │
                         │                                                              │
    ┌───────────┐        │   ┌────────────────────────────────────────────────────┐    │
    │           │        │   │                                                    │    │
    │Authenticated│──────│──▶│              Sign In / Sign Up                     │    │
    │   User    │        │   │                                                    │    │
    │           │        │   └────────────────────────────────────────────────────┘    │
    └───────────┘        │                                                              │
         │               │   ┌────────────────────────────────────────────────────┐    │
         │               │   │                                                    │    │
         ├───────────────│──▶│              Save Bookmarks                        │    │
         │               │   │                                                    │    │
         │               │   └────────────────────────────────────────────────────┘    │
         │               │                                                              │
         │               │   ┌────────────────────────────────────────────────────┐    │
         │               │   │                                                    │    │
         ├───────────────│──▶│              Submit Feedback                       │    │
         │               │   │                                                    │    │
         │               │   └────────────────────────────────────────────────────┘    │
         │               │                                                              │
         │               │   ┌────────────────────────────────────────────────────┐    │
         │               │   │                                                    │    │
         └───────────────│──▶│              Manage Profile                        │    │
                         │   │                                                    │    │
                         │   └────────────────────────────────────────────────────┘    │
                         │                                                              │
                         └──────────────────────────────────────────────────────────────┘
                                                    │
                                                    │
                         ┌──────────────────────────┼──────────────────────────┐
                         │                          │                          │
                         ▼                          ▼                          ▼
                  ┌─────────────┐           ┌─────────────┐           ┌─────────────┐
                  │   OpenAI    │           │  Supabase   │           │   Resend    │
                  │   (AI)      │           │  (DB/Auth)  │           │   (Email)   │
                  └─────────────┘           └─────────────┘           └─────────────┘
```

---

## Sequence Diagrams

### Sequence 1: Browse Law and Get Explanation

```
┌──────┐          ┌──────────┐          ┌──────────┐          ┌──────────┐          ┌──────────┐
│User  │          │ Browser  │          │  Next.js │          │ Supabase │          │  OpenAI  │
│      │          │ (React)  │          │   API    │          │    DB    │          │   API    │
└──┬───┘          └────┬─────┘          └────┬─────┘          └────┬─────┘          └────┬─────┘
   │                   │                      │                     │                     │
   │  1. Navigate to   │                      │                     │                     │
   │  /laws/constitution│                     │                     │                     │
   │──────────────────▶│                      │                     │                     │
   │                   │                      │                     │                     │
   │                   │  2. SSR: Fetch law   │                     │                     │
   │                   │  (server component)  │                     │                     │
   │                   │─────────────────────▶│                     │                     │
   │                   │                      │  3. Query law       │                     │
   │                   │                      │  with sections      │                     │
   │                   │                      │────────────────────▶│                     │
   │                   │                      │                     │                     │
   │                   │                      │  4. Law data        │                     │
   │                   │                      │◀────────────────────│                     │
   │                   │                      │                     │                     │
   │                   │  5. Rendered HTML    │                     │                     │
   │  6. View law      │◀─────────────────────│                     │                     │
   │  structure        │                      │                     │                     │
   │◀──────────────────│                      │                     │                     │
   │                   │                      │                     │                     │
   │  7. Click         │                      │                     │                     │
   │  "Explain Section"│                      │                     │                     │
   │──────────────────▶│                      │                     │                     │
   │                   │                      │                     │                     │
   │                   │  8. POST /api/       │                     │                     │
   │                   │  explanations/stream │                     │                     │
   │                   │─────────────────────▶│                     │                     │
   │                   │                      │                     │                     │
   │                   │                      │  9. Check cache     │                     │
   │                   │                      │────────────────────▶│                     │
   │                   │                      │                     │                     │
   │                   │                      │  10. Cache miss     │                     │
   │                   │                      │◀────────────────────│                     │
   │                   │                      │                     │                     │
   │                   │                      │  11. Generate       │                     │
   │                   │                      │  explanation        │                     │
   │                   │                      │────────────────────────────────────────▶│
   │                   │                      │                     │                     │
   │                   │  12. SSE: Streaming  │  13. Stream tokens  │                     │
   │  14. See text     │◀─────────────────────│◀────────────────────────────────────────│
   │  appear           │      response        │                     │                     │
   │◀──────────────────│                      │                     │                     │
   │                   │                      │                     │                     │
   │                   │                      │  15. Save to cache  │                     │
   │                   │                      │────────────────────▶│                     │
   │                   │                      │                     │                     │
   │  16. Full         │  17. Stream complete │                     │                     │
   │  explanation      │◀─────────────────────│                     │                     │
   │◀──────────────────│                      │                     │                     │
   │                   │                      │                     │                     │
```

### Sequence 2: User Authentication (Google OAuth)

```
┌──────┐          ┌──────────┐          ┌──────────┐          ┌──────────┐          ┌──────────┐
│User  │          │ Browser  │          │  Next.js │          │ Supabase │          │  Google  │
│      │          │ (React)  │          │   API    │          │   Auth   │          │  OAuth   │
└──┬───┘          └────┬─────┘          └────┬─────┘          └────┬─────┘          └────┬─────┘
   │                   │                      │                     │                     │
   │  1. Click         │                      │                     │                     │
   │  "Sign in with    │                      │                     │                     │
   │   Google"         │                      │                     │                     │
   │──────────────────▶│                      │                     │                     │
   │                   │                      │                     │                     │
   │                   │  2. supabase.auth    │                     │                     │
   │                   │  .signInWithOAuth    │                     │                     │
   │                   │─────────────────────────────────────────▶│                     │
   │                   │                      │                     │                     │
   │                   │  3. OAuth URL        │                     │                     │
   │                   │◀─────────────────────────────────────────│                     │
   │                   │                      │                     │                     │
   │  4. Redirect to   │                      │                     │                     │
   │  Google           │                      │                     │                     │
   │◀──────────────────│                      │                     │                     │
   │                   │                      │                     │                     │
   │  5. Login at      │                      │                     │                     │
   │  Google           │                      │                     │                     │
   │────────────────────────────────────────────────────────────────────────────────────▶│
   │                   │                      │                     │                     │
   │  6. Grant         │                      │                     │                     │
   │  permission       │                      │                     │                     │
   │────────────────────────────────────────────────────────────────────────────────────▶│
   │                   │                      │                     │                     │
   │                   │                      │                     │  7. Auth code      │
   │                   │                      │                     │◀────────────────────│
   │                   │                      │                     │                     │
   │  8. Redirect to   │                      │                     │  8. Exchange code  │
   │  callback URL     │                      │                     │  for tokens        │
   │◀───────────────────────────────────────────────────────────────│                     │
   │                   │                      │                     │                     │
   │                   │  9. Handle callback  │                     │                     │
   │                   │  /auth/callback      │                     │                     │
   │──────────────────▶│─────────────────────▶│                     │                     │
   │                   │                      │                     │                     │
   │                   │                      │  10. Verify session │                     │
   │                   │                      │────────────────────▶│                     │
   │                   │                      │                     │                     │
   │                   │                      │  11. User + JWT     │                     │
   │                   │                      │◀────────────────────│                     │
   │                   │                      │                     │                     │
   │                   │  12. Set session     │                     │                     │
   │                   │  cookie, redirect    │                     │                     │
   │  13. Logged in    │◀─────────────────────│                     │                     │
   │  dashboard        │                      │                     │                     │
   │◀──────────────────│                      │                     │                     │
   │                   │                      │                     │                     │
```

### Sequence 3: Save Bookmark

```
┌──────┐          ┌──────────┐          ┌──────────┐          ┌──────────┐
│User  │          │ Browser  │          │  Next.js │          │ Supabase │
│      │          │ (React)  │          │   API    │          │    DB    │
└──┬───┘          └────┬─────┘          └────┬─────┘          └────┬─────┘
   │                   │                      │                     │
   │  1. Click         │                      │                     │
   │  bookmark icon    │                      │                     │
   │──────────────────▶│                      │                     │
   │                   │                      │                     │
   │                   │  2. Check auth state │                     │
   │                   │  (client)            │                     │
   │                   │────┐                 │                     │
   │                   │    │ authenticated   │                     │
   │                   │◀───┘                 │                     │
   │                   │                      │                     │
   │                   │  3. POST /api/       │                     │
   │                   │  bookmarks           │                     │
   │                   │  + JWT               │                     │
   │                   │─────────────────────▶│                     │
   │                   │                      │                     │
   │                   │                      │  4. Verify JWT      │
   │                   │                      │  Get user_id        │
   │                   │                      │────────────────────▶│
   │                   │                      │                     │
   │                   │                      │  5. User valid      │
   │                   │                      │◀────────────────────│
   │                   │                      │                     │
   │                   │                      │  6. Check if        │
   │                   │                      │  already bookmarked │
   │                   │                      │────────────────────▶│
   │                   │                      │                     │
   │                   │                      │  7. Not exists      │
   │                   │                      │◀────────────────────│
   │                   │                      │                     │
   │                   │                      │  8. INSERT bookmark │
   │                   │                      │────────────────────▶│
   │                   │                      │                     │
   │                   │                      │  9. Created         │
   │                   │                      │◀────────────────────│
   │                   │                      │                     │
   │                   │  10. 201 Created     │                     │
   │                   │  { bookmark }        │                     │
   │                   │◀─────────────────────│                     │
   │                   │                      │                     │
   │  11. Icon fills,  │                      │                     │
   │  toast: "Saved!"  │                      │                     │
   │◀──────────────────│                      │                     │
   │                   │                      │                     │
```

### Sequence 4: Search with Results

```
┌──────┐          ┌──────────┐          ┌──────────┐          ┌──────────┐
│User  │          │ Browser  │          │  Next.js │          │ Supabase │
│      │          │ (React)  │          │   API    │          │    DB    │
└──┬───┘          └────┬─────┘          └────┬─────┘          └────┬─────┘
   │                   │                      │                     │
   │  1. Type in       │                      │                     │
   │  search box       │                      │                     │
   │  "police arrest"  │                      │                     │
   │──────────────────▶│                      │                     │
   │                   │                      │                     │
   │                   │  2. Debounce 300ms   │                     │
   │                   │────┐                 │                     │
   │                   │    │                 │                     │
   │                   │◀───┘                 │                     │
   │                   │                      │                     │
   │                   │  3. GET /api/search/ │                     │
   │                   │  suggestions?q=police│                     │
   │                   │─────────────────────▶│                     │
   │                   │                      │                     │
   │                   │                      │  4. FTS query       │
   │                   │                      │  scenarios + sections│
   │                   │                      │────────────────────▶│
   │                   │                      │                     │
   │                   │                      │  5. Top 5 matches   │
   │                   │                      │◀────────────────────│
   │                   │                      │                     │
   │                   │  6. Suggestions      │                     │
   │  7. See dropdown  │◀─────────────────────│                     │
   │  suggestions      │                      │                     │
   │◀──────────────────│                      │                     │
   │                   │                      │                     │
   │  8. Press Enter   │                      │                     │
   │  or click search  │                      │                     │
   │──────────────────▶│                      │                     │
   │                   │                      │                     │
   │                   │  9. GET /api/search  │                     │
   │                   │  ?q=police+arrest    │                     │
   │                   │─────────────────────▶│                     │
   │                   │                      │                     │
   │                   │                      │  10. Full-text      │
   │                   │                      │  search with ranking│
   │                   │                      │────────────────────▶│
   │                   │                      │                     │
   │                   │                      │  11. Ranked results │
   │                   │                      │◀────────────────────│
   │                   │                      │                     │
   │                   │                      │  12. Log search     │
   │                   │                      │  (analytics)        │
   │                   │                      │────────────────────▶│
   │                   │                      │                     │
   │                   │  13. Search results  │                     │
   │  14. View results │◀─────────────────────│                     │
   │  page             │                      │                     │
   │◀──────────────────│                      │                     │
   │                   │                      │                     │
```

---

## State Diagram

### User Session Lifecycle

```
                         ┌─────────────────┐
                         │                 │
                         │     START       │
                         │                 │
                         └────────┬────────┘
                                  │
                                  │ visit site
                                  ▼
                         ┌─────────────────┐
                         │                 │
                    ┌────│     GUEST       │────┐
                    │    │                 │    │
                    │    └────────┬────────┘    │
                    │             │             │
                    │ browse      │ click       │ close
                    │ laws        │ sign in     │ tab
                    │             ▼             │
                    │    ┌─────────────────┐    │
                    │    │                 │    │
                    │    │  AUTHENTICATING │    │
                    │    │                 │    │
                    │    └────────┬────────┘    │
                    │             │             │
                    │    ┌────────┼────────┐    │
                    │    │ success│ failure│    │
                    │    ▼        │        ▼    │
                    │ ┌──────────┐│ ┌──────────┐│
                    │ │          ││ │          ││
                    │ │AUTHENTICATED│ │  ERROR   ││
                    │ │          │◀─│          ││
                    │ └─────┬────┘  └──────────┘│
                    │       │                   │
                    │       │ sign out          │
                    │       ▼                   │
                    │ ┌──────────┐              │
                    │ │          │              │
                    └▶│   GUEST  │◀─────────────┘
                      │          │
                      └──────────┘
```

### Explanation Request Lifecycle

```
                         ┌─────────────────┐
                         │                 │
                         │     IDLE        │
                         │                 │
                         └────────┬────────┘
                                  │
                                  │ user clicks "Explain"
                                  ▼
                         ┌─────────────────┐
                         │                 │
                         │  CHECK CACHE    │
                         │                 │
                         └────────┬────────┘
                                  │
                         ┌────────┼────────┐
                         │ hit    │ miss   │
                         ▼        │        ▼
                  ┌──────────────┐│┌──────────────┐
                  │              │││              │
                  │ SHOW CACHED  │││  GENERATING  │
                  │              │││  (streaming) │
                  └──────┬───────┘│└──────┬───────┘
                         │        │       │
                         │        │       │ complete
                         │        │       ▼
                         │        │┌──────────────┐
                         │        ││              │
                         │        ││  SAVE CACHE  │
                         │        ││              │
                         │        │└──────┬───────┘
                         │        │       │
                         ▼        ▼       ▼
                         ┌─────────────────┐
                         │                 │
                         │   DISPLAYING    │
                         │                 │
                         └────────┬────────┘
                                  │
                                  │ navigate away
                                  ▼
                         ┌─────────────────┐
                         │                 │
                         │     IDLE        │
                         │                 │
                         └─────────────────┘
```

---

## Activity Diagram

### Find Relevant Law for Scenario

```
              ┌───────────────────┐
              │       Start       │
              └─────────┬─────────┘
                        │
                        ▼
              ┌───────────────────┐
              │  User has legal   │
              │     question      │
              └─────────┬─────────┘
                        │
                        ▼
                   ┌─────────┐
                  ╱           ╲
                 ╱  Know which  ╲
                ╱   law applies? ╲
                ╲               ╱
                 ╲             ╱
                  ╲           ╱
                   └────┬────┘
                  Yes   │   No
              ┌─────────┴─────────┐
              │                   │
              ▼                   ▼
    ┌───────────────────┐ ┌───────────────────┐
    │  Browse Laws      │ │ Explore Scenarios │
    │  Directly         │ │ "I'm dealing with"│
    └─────────┬─────────┘ └─────────┬─────────┘
              │                     │
              │                     ▼
              │           ┌───────────────────┐
              │           │  Select matching  │
              │           │     scenario      │
              │           └─────────┬─────────┘
              │                     │
              │                     ▼
              │           ┌───────────────────┐
              │           │  View related     │
              │           │    sections       │
              │           └─────────┬─────────┘
              │                     │
              └──────────┬──────────┘
                         │
                         ▼
              ┌───────────────────┐
              │  Read section     │
              │  content          │
              └─────────┬─────────┘
                        │
                        ▼
                   ┌─────────┐
                  ╱           ╲
                 ╱   Need      ╲
                ╱  explanation? ╲
                ╲               ╱
                 ╲             ╱
                  ╲           ╱
                   └────┬────┘
                  Yes   │   No
              ┌─────────┴─────────┐
              │                   │
              ▼                   │
    ┌───────────────────┐         │
    │  Request AI       │         │
    │  explanation      │         │
    └─────────┬─────────┘         │
              │                   │
              ▼                   │
    ┌───────────────────┐         │
    │  View plain       │         │
    │  language + examples│       │
    └─────────┬─────────┘         │
              │                   │
              └──────────┬────────┘
                         │
                         ▼
                   ┌─────────┐
                  ╱           ╲
                 ╱  Satisfied? ╲
                ╲               ╱
                 ╲             ╱
                  ╲           ╱
                   └────┬────┘
                  Yes   │   No
              ┌─────────┴─────────┐
              │                   │
              ▼                   ▼
    ┌───────────────────┐ ┌───────────────────┐
    │  Bookmark for     │ │  Search for more  │
    │  later reference  │ │  information      │
    └─────────┬─────────┘ └─────────┬─────────┘
              │                     │
              └──────────┬──────────┘
                         │
                         ▼
              ┌───────────────────┐
              │        End        │
              └───────────────────┘
```

---

## Class Diagram (Service Layer)

```
┌────────────────────────────────────────┐
│           <<interface>>                │
│             IService                   │
├────────────────────────────────────────┤
└────────────────────────────────────────┘
                    △
                    │ implements
       ┌────────────┼────────────┬────────────────┐
       │            │            │                │
       ▼            ▼            ▼                ▼
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│ LawService  │ │  AIService  │ │SearchService│ │ UserService │
├─────────────┤ ├─────────────┤ ├─────────────┤ ├─────────────┤
│ - prisma    │ │ - openai    │ │ - prisma    │ │ - prisma    │
│             │ │ - prisma    │ │             │ │ - supabase  │
├─────────────┤ ├─────────────┤ ├─────────────┤ ├─────────────┤
│ +getLaws()  │ │ +explain()  │ │ +search()   │ │ +getUser()  │
│ +getLaw()   │ │ +stream()   │ │ +suggest()  │ │ +update()   │
│ +getSection()││ +cache()    │ │ +log()      │ │ +delete()   │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
       │              │               │               │
       │              │               │               │
       ▼              ▼               ▼               ▼
┌─────────────────────────────────────────────────────────────┐
│                       PrismaClient                          │
├─────────────────────────────────────────────────────────────┤
│ + law                                                       │
│ + section                                                   │
│ + article                                                   │
│ + scenario                                                  │
│ + user                                                      │
│ + bookmark                                                  │
│ + explanation                                               │
│ + feedback                                                  │
└─────────────────────────────────────────────────────────────┘
                            │
                            │ uses
                            ▼
                   ┌─────────────────┐
                   │   PostgreSQL    │
                   │   (Supabase)    │
                   └─────────────────┘
```

---

*Document: 19 of 20 | Phase 5: Detailed Design*
*Project: LawMadeSimple | Created: January 2026*
